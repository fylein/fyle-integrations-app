<div [formGroup]="form" class="tw-p-24-px">
    <div *ngIf="!isDefaultFields" class="tw-flex tw-flex-row tw-justify-between tw-items-center">
        <div class="lg:tw-w-3/5 md:tw-w-1/2 tw-flex tw-items-start">
            <div [ngClass]="[iconPath || formControllerName === 'dayOfMonth' || formControllerName === 'dayOfWeek' || formControllerName === 'timeOfDay' ? 'tw-pr-16-px tw-mt-4-px' : 'tw-pr-40-px']">
                <svg-icon-sprite *ngIf="iconPath" src="{{iconPath}}" width="20px" hight="20px" class="tw-text-mandatory-field-color"></svg-icon-sprite>
            </div>
            
            <div>
                <h5 class="tw-text-slightly-normal-text-color tw-text-14-px !tw-font-500">{{ label | snakeCaseToSpaceCase}}<app-mandatory-field *ngIf="isFieldMandatory"></app-mandatory-field></h5>
                <h5 *ngIf="formControllerName!=='reimbursableExportType' && formControllerName!=='cccExportType'" class="!tw-text-faded-text-color tw-text-14-px tw-pt-8-px !tw-font-400 !tw-leading-4" [innerHTML]="subLabel"></h5>
                <h5 *ngIf="formControllerName==='reimbursableExportType'" class="!tw-text-faded-text-color tw-text-14-px tw-pt-8-px !tw-font-400 !tw-leading-4">
                    Choose the type of transaction record that you would like to create in {{ appName }} while exporting expenses from Fyle. Click<a (click)="showExportTable()" class="tw-cursor-pointer tw-text-hyperlink-color"> here</a> for more details.
                </h5>
                <h5 *ngIf="formControllerName==='cccExportType'" class="!tw-text-faded-text-color tw-text-14-px tw-pt-8-px !tw-font-400 !tw-leading-4">
                    Choose the type of transaction record that you would like to create in {{ appName }} while exporting expenses from Fyle. Click<a (click)="showExportTable()" class="tw-cursor-pointer tw-text-hyperlink-color"> here</a> for more details.
                </h5>
            </div>
        </div>
        <div>
            <div class="p-field-checkbox tw-pl-34-px" *ngIf="destinationAttributes">
                <p-dropdown 
                    appendTo="body"
                    [options]="destinationAttributes"
                    optionLabel="value" class="!tw-w-300-px"
                    [formControlName]="formControllerName"
                    [placeholder]="placeholder"
                    [ngClass]="{
                        'error-box': form.controls[formControllerName].invalid && isFieldMandatory && form.controls[formControllerName].touched,
                        'normal-box': !form.controls[formControllerName].invalid || !isFieldMandatory || !form.controls[formControllerName].touched,
                        'hide-chevron': !isOptionSearchInProgress && form.controls[formControllerName].value
                    }"            
                    [filter]="true" 
                    filterBy="value"
                    (onFilter)="searchOptions($event)"
                    [emptyFilterMessage]="isOptionSearchInProgress ? 'Searching...' : 'No results found'" 
                    [dropdownIcon]="isOptionSearchInProgress ? 'pi pi-spinner pi-spin' : (form.controls[formControllerName].value ? '' : 'pi pi-chevron-down')"
                    >
                    <ng-template let-option pTemplate="item">
                        <div #textElement 
                            class="truncate"
                            [ngClass]="{'max-w-[16rem]': true}"
                            [pTooltip]="isOverflowing(textElement) ? option.label : null" tooltipPosition="top">
                            {{option.label}}
                        </div>
                    </ng-template>            
                    <ng-template pTemplate="selectedItem" let-item>
                        <div class="tw-flex tw-justify-between tw-items-center">
                            <span>
                                {{ item.label }}
                            </span>
                            <i *ngIf="!isOptionSearchInProgress&&showClearIcon" class="pi pi-times" (click)="removeFilter(form.controls[formControllerName])"></i>
                        </div>
                    </ng-template>
                </p-dropdown>
            </div>
            <div *ngIf="options && !destinationAttributes && !simpleOptions">
                <div class="p-field-checkbox tw-pl-34-px" *ngIf="formControllerName !== 'dayOfMonth' && formControllerName !== 'dayOfWeek' && formControllerName !== 'timeOfDay' && !destinationAttributes">
                    <p-dropdown appendTo="body" [options]="options" class="!tw-w-300-px" 
                    [formControlName]="formControllerName" [placeholder]="placeholder"
                    [ngClass]="[form.controls[formControllerName].invalid && isFieldMandatory && form.controls[formControllerName].touched ? 'error-box' : 'normal-box']"
                    [ngClass]="{'selectedItem': form.controls[formControllerName].value, 'filterDropdown': !form.controls[formControllerName].value}"
                    >
                    <ng-template let-option pTemplate="item">
                        <div #textElement 
                            [ngStyle]="{'white-space': 'nowrap', 'overflow': 'hidden', 'text-overflow': 'ellipsis', 'max-width': '16rem'}"
                            [pTooltip]="isOverflowing(textElement) ? option.label : null" tooltipPosition="top">
                            {{option.label}}
                        </div>
                    </ng-template>
                    <ng-template pTemplate="selectedItem" let-item>
                        <div class="tw-flex tw-justify-between tw-items-center">
                            <span>
                                {{ item.label }}
                            </span>
                            <i class="pi pi-times" (click)="removeFilter(form.controls[formControllerName])"></i>
                        </div>
                    </ng-template>
                </p-dropdown>                     
                    <div *ngIf="form.controls[formControllerName].value==='JOURNAL_ENTRY' || form.controls[formControllerName].value === 'EXPENSE_REPORT' || form.controls[formControllerName].value === 'BILL' || form.controls[formControllerName].value === 'CHARGE_CARD_TRANSACTION' || form.controls[formControllerName].value === 'PURCHASE_INVOICE' || form.controls[formControllerName].value === 'DIRECT_COST'" class="sub-text tw-pt-3-px">
                        <span>Click </span>
                        <a (click)="showExportPreviewDialog(form.controls[formControllerName].value)">here</a>
                        <span> to preview how it looks on {{appName}}</span>
                    </div>
                    <div *ngIf="form.controls[formControllerName].value==='spent_at' && isOnboarding" class="sub-text">
                        <span>Using the Spend Date may lead to multiple single line<br>item entries.</span>
                    </div>
                </div>
                
                <div>
                    <h5 class="tw-text-slightly-normal-text-color tw-text-14-px !tw-font-500">{{ label | snakeCaseToSpaceCase}}<app-mandatory-field *ngIf="isFieldMandatory"></app-mandatory-field></h5>
                    <h5 *ngIf="formControllerName!=='reimbursableExportType' && formControllerName!=='cccExportType'" class="!tw-text-faded-text-color tw-text-14-px tw-pt-8-px !tw-font-400 !tw-leading-4" [innerHTML]="subLabel"></h5>
                    <h5 *ngIf="formControllerName==='reimbursableExportType'" class="!tw-text-faded-text-color tw-text-14-px tw-pt-8-px !tw-font-400 !tw-leading-4">
                        Choose the type of transaction record that you would like to create in {{ appName }} while exporting expenses from Fyle. Click<a (click)="showExportTable()" class="tw-cursor-pointer tw-text-hyperlink-color"> here</a> for more details.
                    </h5>
                    <h5 *ngIf="formControllerName==='cccExportType'" class="!tw-text-faded-text-color tw-text-14-px tw-pt-8-px !tw-font-400 !tw-leading-4">
                        Choose the type of transaction record that you would like to create in {{ appName }} while exporting expenses from Fyle. Click<a (click)="showExportTable()" class="tw-cursor-pointer tw-text-hyperlink-color"> here</a> for more details.
                    </h5>
                </div>
            </div>
            <div>
                <div *ngIf="destinationAttributes">
                    <p-dropdown appendTo="body" [options]="destinationAttributes" optionLabel="value" class="!tw-w-300-px" [formControlName]="formControllerName" [placeholder]="placeholder" [ngClass]="[form.controls[formControllerName].invalid && isFieldMandatory && form.controls[formControllerName].touched ? 'error-box' : 'normal-box']">
                    </p-dropdown>
                </div>
                <div *ngIf="options && !destinationAttributes && !simpleOptions" class="tw-flex tw-justify-end">
                    <div *ngIf="formControllerName !== 'dayOfMonth' && formControllerName !== 'dayOfWeek' && formControllerName !== 'timeOfDay' && !destinationAttributes">
                        <p-dropdown *ngIf="formControllerName !== 'scheduleAutoExportFrequency'" appendTo="body" [options]="options" class="!tw-w-300-px" 
                            [formControlName]="formControllerName" [placeholder]="placeholder"
                            [ngClass]="{
                                'error-box': form.controls[formControllerName].invalid && isFieldMandatory && form.controls[formControllerName].touched,
                                'normal-box': !(form.controls[formControllerName].invalid && isFieldMandatory && form.controls[formControllerName].touched),
                                'selectedItem': form.controls[formControllerName].value,
                                'filterDropdown': !form.controls[formControllerName].value
                            }"
                            >
                            <ng-template let-option pTemplate="item">
                                <div #textElement 
                                    [ngStyle]="{'white-space': 'nowrap', 'overflow': 'hidden', 'text-overflow': 'ellipsis', 'max-width': '16rem'}"
                                    [pTooltip]="isOverflowing(textElement) ? option.label : null" tooltipPosition="top">
                                    {{option.label}}
                                </div>
                            </ng-template>
                            <ng-template pTemplate="selectedItem" let-item>
                                <div class="tw-flex tw-justify-between tw-items-center">
                                    <span>
                                        {{ item.label }}
                                    </span>
                                    <i class="pi pi-times" (click)="removeFilter(form.controls[formControllerName])"></i>
                                </div>
                            </ng-template>
                        </p-dropdown>
                        <div class="tw-flex" *ngIf="formControllerName === 'scheduleAutoExportFrequency'">
                            <p-dropdown appendTo="body" [options]="options" class="dropdown-size-schedule" 
                                [formControlName]="formControllerName" [placeholder]="placeholder"
                                [ngClass]="{
                                    'error-box': form.controls[formControllerName].invalid && isFieldMandatory && form.controls[formControllerName].touched,
                                    'normal-box': !(form.controls[formControllerName].invalid && isFieldMandatory && form.controls[formControllerName].touched),
                                    'selectedItem': form.controls[formControllerName].value,
                                    'filterDropdown': !form.controls[formControllerName].value
                                }"
                                >
                                <ng-template let-option pTemplate="item">
                                    <div #textElement 
                                        [ngStyle]="{'white-space': 'nowrap', 'overflow': 'hidden', 'text-overflow': 'ellipsis', 'max-width': '16rem'}"
                                        [pTooltip]="isOverflowing(textElement) ? option.label : null" tooltipPosition="top">
                                        {{option.label}}
                                    </div>
                                </ng-template>
                                <ng-template pTemplate="selectedItem" let-item>
                                    <div class="tw-flex tw-justify-between tw-items-center">
                                        <span>
                                            {{ item.label }}
                                        </span>
                                        <i class="pi pi-angle-down" (click)="removeFilter(form.controls[formControllerName])"></i>
                                    </div>
                                </ng-template>
                            </p-dropdown>
                            <div class="tw-ml-16-px">
                                <input type="text" class="tw-border-box-color !tw-w-100-px !tw-h-40-px !tw-bg-disabled-bg-color tw-text-slightly-normal-text-color" pInputText disabled value="Hours">
                            </div>
                        </div>                     
                        <div *ngIf="form.controls[formControllerName].value==='JOURNAL_ENTRY' || form.controls[formControllerName].value === 'EXPENSE_REPORT' || form.controls[formControllerName].value === 'BILL' || form.controls[formControllerName].value === 'CHARGE_CARD_TRANSACTION' || form.controls[formControllerName].value === 'PURCHASE_INVOICE' || form.controls[formControllerName].value === 'DIRECT_COST'" class="sub-text tw-pt-3-px">
                            <span>Click </span>
                            <a (click)="showExportPreviewDialog(form.controls[formControllerName].value)">here</a>
                            <span> to preview how it looks on {{appName}}</span>
                        </div>
                        <div *ngIf="form.controls[formControllerName].value==='spent_at' && isOnboarding" class="sub-text">
                            <span>Using the Spend Date may lead to multiple single line<br>item entries.</span>
                        </div>
                    </div>
                    <div class="tw-pl-30-px tw-flex tw-justify-end tw-items-end" *ngIf="formControllerName === 'dayOfMonth' || formControllerName === 'dayOfWeek' || formControllerName === 'timeOfDay'">
                        <div *ngIf="formControllerName === 'dayOfWeek'" class="tw-mr-18-px dropdown-monthy">
                            <p class="tw-font-400 tw-text-faded-text-color tw-text-14-px">Day</p>
                            <p-dropdown appendTo="body" [options]="options" [formControlName]="formControllerName" [placeholder]="placeholder" [ngClass]="[form.controls[formControllerName].invalid && isFieldMandatory && form.controls[formControllerName].touched ? 'error-box' : 'normal-box']">
                                <ng-template let-value pTemplate="selectedItem" >
                                    <div *ngIf="form.value[formControllerName]" class="tw-flex">
                                        <p>{{ value | titlecase | snakeCaseToSpaceCase }}</p>
                                    </div>
                                    <div *ngIf="!form.value[formControllerName]" class="tw-text-placeholder">
                                        {{ placeholder }}
                                    </div>
                                </ng-template>
                                <ng-template let-day pTemplate="item">
                                    <div>
                                        <p class="tw-text-sub-text-color tw-text-14-px">{{ day | titlecase | snakeCaseToSpaceCase }}</p>
                                    </div>
                                </ng-template>
                            </p-dropdown>
                        </div>
                        <div *ngIf="formControllerName === 'dayOfMonth'" class="p-field-checkbox tw-mr-20-px tw-pl-34-px">
                            <p class="tw-font-400 tw-text-faded-text-color tw-text-14-px">Day</p>
                            <p-dropdown appendTo="body" [options]="options" class="dropdown-monthy" [formControlName]="formControllerName" [placeholder]="placeholder" [ngClass]="[form.controls[formControllerName].invalid && isFieldMandatory && form.controls[formControllerName].touched ? 'error-box' : 'normal-box']"></p-dropdown>
                        </div>
                        <div class="tw-mr-18-px" [ngClass]="[formControllerName === 'dayOfMonth' || formControllerName === 'dayOfWeek' ? 'dropdown-time' : 'dropdown-time-alone']">
                            <p class="tw-font-400 tw-text-faded-text-color tw-text-14-px">Time</p>
                            <p-dropdown appendTo="body" [options]="timeOption" formControlName="timeOfDay" placeholder="Select Time for export" ></p-dropdown>
                        </div>
                        <div [ngClass]="[formControllerName === 'dayOfMonth' || formControllerName === 'dayOfWeek' ? 'dropdown-time' : 'dropdown-time-alone']">
                            <p-dropdown appendTo="body" [options]="meridiemOption" formControlName="meridiem" placeholder="Select meridiem of time" ></p-dropdown>
                        </div>
                    </div>
                </div>
                <div *ngIf="simpleOptions && !options" class="p-field-checkbox tw-pl-34-px">
                    <p-dropdown appendTo="body" [options]="simpleOptions" [formControlName]="formControllerName" [placeholder]="placeholder" [ngClass]="[form.controls[formControllerName].invalid && isFieldMandatory && form.controls[formControllerName].touched ? 'error-box' : 'normal-box']">
                        <ng-template let-value pTemplate="selectedItem" >
                            <div *ngIf="form.value[formControllerName]" class="tw-flex">
                                <p>{{ value | titlecase | snakeCaseToSpaceCase }}</p>
                            </div>
                            <div *ngIf="!form.value[formControllerName]" class="tw-text-placeholder">
                                {{ placeholder }}
                            </div>
                        </ng-template>
                        <ng-template let-memo pTemplate="item">
                            <div>
                                <p class="tw-text-sub-text-color tw-text-14-px">{{ memo | titlecase | snakeCaseToSpaceCase }}</p>
                            </div>
                        </ng-template>
                    </p-dropdown>
                </div>
                <div [ngClass]="[formControllerName !== 'dayOfMonth' ? 'tw-pl-34-px' : 'tw-pl-70-px', formControllerName === 'dayOfWeek' ? 'tw-pl-30-px' : 'tw-pl-34-px']">
                    <app-mandatory-error-message *ngIf="isFieldMandatory && form.controls[formControllerName].touched && !form.controls[formControllerName].valid && !form.controls[formControllerName].disabled" [listName]="mandatoryErrorListName" [customErrorMessage]="customErrorMessage"></app-mandatory-error-message>
                </div> 
            </div>
        </div>
    </div>
    <div *ngIf="isDefaultFields">
        <div class="tw-text-faded-text-color tw-text-14-px">
            <div>
                <label>{{label}}</label>
            </div>
            <div class="tw-pt-2">
                <p-dropdown appendTo="body" [options]="destinationAttributes" optionLabel="value"
                [formControlName]="formControllerName" [placeholder]="placeholder" [ngClass]="{'selectedItem': form.controls[formControllerName].value, 'filterDropdown': !form.controls[formControllerName].value}">
                    <ng-template pTemplate="selectedItem" let-item>
                        <div class="tw-flex tw-justify-between tw-items-center">
                            <span>
                                {{ item.value }}
                            </span>
                            <i class="pi pi-times" (click)="removeFilter(form.controls[formControllerName])"></i>
                        </div>
                    </ng-template>
                </p-dropdown>
            </div>  
        </div>
    </div>
</div>

<div *ngIf="isPreviewDialogVisible">
    <app-preview-dialog [isPreviewDialogVisible]="true" [iconPath]="exportTypeIconPath" (closeDialog)="closeDialog()" [header]="dialogHeader"></app-preview-dialog>
</div>
