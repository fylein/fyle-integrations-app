<div [formGroup]="form">
    <div *ngIf="defaultImportFields" class="tw-mx-20-px tw-mt-18px">
        <div *ngFor="let defaultField of defaultImportFields; let i = index">
            <div class="tw-pt-18-px">
                <div class="tw-flex tw-justify-start tw-items-center inputbox">
                    <div>
                        <div *ngIf="i===0" class="tw-text-16-px tw-font-500 tw-text-normal-text-color tw-mb-18-px">
                            <p>{{appName}} Dimensions</p>
                        </div>
                        <input type="text" class="tw-text-14-px tw-text-text-secondary !tw-font-500 !tw-px-14-px !tw-py-10-px tw-border tw-border-solid !tw-border-separator tw-rounded-4-px" value="{{ defaultField.destination_field | snakeCaseToSpaceCase | titlecase }}" disabled>
                    </div>
                    <div class="tw-pt-18-px">
                        <div *ngIf="i===0" class="tw-mb-20-px">
                        </div>
                        <div [ngClass]="{'!tw-mt-6-px': i!==0}">
                            <app-svg-icon [isTextColorAllowed]="true" [svgSource]="'arrow-line'" [height]="i === 0 ? '6px' : '30px'" [width]="'100px'" [styleClasses]="'!tw-ml-0 tw-text-box-color tw-self-center'"></app-svg-icon>
                        </div>
                    </div>
                    <div>
                        <div *ngIf="i===0" class="tw-text-16-px tw-font-500 tw-text-normal-text-color tw-mb-18-px">
                            <p>{{brandingConfig.brandName}} Fields</p>
                        </div>
                        <input type="text" class="tw-text-14-px tw-text-text-secondary !tw-font-500 !lg:tw-w-300-px !md:tw-w-260-px !tw-px-14-px !tw-py-10-px tw-border tw-border-solid !tw-border-separator tw-rounded-4-px" value="{{ defaultField.source_field | snakeCaseToSpaceCase | titlecase }}" disabled>
                    </div>
                    <div class="tw-w-150-px">
                        <div>
                            <div *ngIf="i===0" class="fields-header-text tw-flex tw-justify-center tw-mb-30-px tw-mt-[-6px]">
                                Import to {{brandingConfig.brandName}}
                                <app-svg-icon [svgSource]="'info-circle-fill'" [width]="'16px'" [height]="'16px'" [styleClasses]="'tw-text-text-muted'" [tooltipPosition]="'top'"
                                    [tooltipText]="'Importing a dimension syncs active values from ' + appName + ' every 24 hours. Deactivated values in ' + appName + ' will also be disabled in ' + brandingConfig.brandName + ''">
                                </app-svg-icon>
                            </div>
                            <div class="tw-flex tw-justify-center" [ngClass]="{'!tw-mt-6-px': i!==0, 'tw-pt-2-px': i===0}">
                                <p-inputSwitch [formControlName]="defaultField.formController"></p-inputSwitch>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div *ngIf="fyleFieldOptions && accountingFieldOptions" formArrayName="expenseFields" [ngClass]="[isDestinationFixedImport ? '' : 'tw-mt-18px']">
        <div *ngFor="let expenseField of expenseFieldsGetter.controls; let i = index" [formGroupName]="i" [ngClass]="{'tw-mt-24-px tw-pb-24-px': isDestinationFixedImport, 'tw-rounded-lg tw-border-separator tw-border': isDestinationFixedImport && !isCloneSettingView, 'tw-pr-24-px': isCloneSettingView}">
            <div [ngClass]="{'tw-bg-configuration-bg tw-rounded-8-px tw-py-16-px tw-pr-20-px': expenseField.value.source_field === 'PROJECT' && expenseField.value.import_to_fyle && expenseField.value.destination_field === dependentDestinationValue, 'tw-mt-18-px tw-pl-20-px': !isDestinationFixedImport}">
                <div *ngIf="isDestinationFixedImport">
                    <div [ngClass]="!isCloneSettingView ? 'tw-p-24-px': 'tw-pl-24-px'" class="tw-flex tw-justify-between">
                        <div class="tw-w-3/4 tw-flex tw-items-start">
                            <div class="tw-pr-16-px">
                                <app-svg-icon [svgSource]="'arrow-tail-down'" [width]="'24px'" [height]="'24px'" [styleClasses]="isCloneSettingView ? 'tw-text-menu-inactive-text-color tw-block tw-ml-0' : 'tw-text-mandatory-field-color tw-block tw-ml-0'"></app-svg-icon>
                            </div>
                            <div>
                                <h4 class="tw-text-text-secondary" [ngClass]="isCloneSettingView ? 'tw-py-2-px tw-text-14-px' : 'tw-text-16-px !tw-font-500'">
                                    Import {{ expenseField.value.destination_field | snakeCaseToSpaceCase | titlecase }} from {{ appName }}
                                </h4>
                                <h5 *ngIf="!isCloneSettingView" class="!tw-text-text-muted tw-text-14-px tw-pt-8-px !tw-font-400 !tw-leading-4">
                                The imported {{ expenseField.value.destination_field | snakeCaseToSpaceCase | titlecase }} from {{ appName }} will be a selectable field while creating an expense.
                                </h5>        
                            </div>
                        </div>
                        <div class="configuration--input-toggle-section">
                            <p-inputSwitch formControlName="import_to_fyle"></p-inputSwitch>
                        </div>
                    </div>
                </div>
                <div class="tw-flex inputbox" [ngClass]="{'tw-pl-60-px': isDestinationFixedImport, 'tw-mt-24-px': isCloneSettingView}">
                    <div>
                        <div *ngIf="i===0 && appName === AppName.INTACCT" class="tw-text-16-px tw-font-500 tw-text-normal-text-color tw-mb-18-px">
                            <p>{{appName}} Dimensions</p>
                        </div>
                        <div>
                            <p-dropdown appendTo="body" [options]="accountingFieldOptions" placeholder="Choose {{appName}} field" formControlName="destination_field" [dropdownIcon]="'pi pi-chevron-down ' + brandingConfig.brandId"
                                optionLabel="display_name" optionValue="attribute_type" [disabled]="isDestinationFixedImport" [ngClass]="{'selectedAccItem !tw-text-text-secondary': isDestinationFixedImport}">
                                <ng-template let-option pTemplate="item">
                                    <div>
                                        {{ option.display_name | snakeCaseToSpaceCase | titlecase }}
                                    </div>
                                </ng-template>
                                <ng-template pTemplate="selectedItem" let-item>
                                    <div class="tw-flex tw-justify-between tw-items-center">
                                        <span>
                                            {{ item.display_name | snakeCaseToSpaceCase | titlecase }}
                                        </span>
                                    </div>
                                </ng-template>
                            </p-dropdown>
                            <p *ngIf="expenseField.value.destination_field && !expenseField.valid && !hasDuplicateOption(expenseField, i, 'destination_field')" class="tw-text-alert-toast tw-text-12-px tw-pt-4-px">
                                {{appName}} Fields should be unique
                            </p>
                        </div>
                    </div>
                    <div class="tw-align-middle">
                        <div *ngIf="i===0 && appName === AppName.INTACCT" class="tw-text-16-px tw-font-500 tw-text-white tw-mb-34-px">
                            <p>Dimensions</p>
                        </div>
                        <div [ngClass]="{'!tw-mt-16-px': i!==0 || i===0 && appName !== AppName.INTACCT}">
                            <app-svg-icon [isTextColorAllowed]="true" [svgSource]="'arrow-line'" [height]="'10px'" [width]="'100px'" [styleClasses]="'tw-text-box-color tw-self-center'"></app-svg-icon>
                        </div>
                    </div>
                    <div>
                        <div *ngIf="i===0 && appName === AppName.INTACCT" class="tw-text-16-px tw-font-500 tw-text-normal-text-color tw-mb-18-px">
                            <p>{{brandingConfig.brandName}} Fields</p>
                        </div>
                        <p-dropdown (onChange)="onDropdownChange($event, i)" appendTo="body" [options]="fyleFieldOptions" [placeholder]="'Choose ' + brandingConfig.brandName + ' Expense field'" formControlName="source_field"
                            optionLabel="display_name" optionValue="attribute_type" [ngClass]="{'selectedItem': expenseField.value.source_field}" [dropdownIcon]="'pi pi-chevron-down ' + brandingConfig.brandId">
                            <ng-template let-option pTemplate="item">
                                <div [ngClass]="{'custom-option': option.attribute_type === 'custom_field'}" class="tw-align-middle">
                                    <div *ngIf="brandingFeatureConfig.isIconsInsideButtonAllowed && option.attribute_type === 'custom_field'" class="tw-ml-0 tw-mr-6-px ">
                                        <app-svg-icon [svgSource]="'plus-square-medium'" [width]="'18px'" [height]="'18px'" ></app-svg-icon>
                                    </div>
                                    {{ option.display_name }}
                                </div>
                            </ng-template>
                            <ng-template pTemplate="selectedItem" let-item>
                            <div class="tw-flex tw-justify-between tw-items-center ">
                                <span>
                                    {{ item.display_name }}
                                </span>
                                <app-svg-icon [svgSource]="'cross-medium'" (click)="removeFilter(expenseField)" [height]="'16px'" [width]="'16px'"></app-svg-icon>
                            </div>
                            </ng-template>
                        </p-dropdown>
                        <p *ngIf="expenseField.value.source_field && !expenseField.valid && !hasDuplicateOption(expenseField, i, 'source_field')" class="tw-text-alert-toast tw-text-12-px tw-pt-4-px">
                            {{brandingConfig.brandName}} Fields should be unique
                        </p>
                    </div>
                    <div class="tw-w-150-px">
                        <div>
                            <div *ngIf="i===0 && appName === AppName.INTACCT" class="fields-header-text tw-flex tw-justify-center tw-mb-30-px">
                                Import to {{brandingConfig.brandName}}
                                <app-svg-icon [svgSource]="'info-circle-fill'" [width]="'16px'" [height]="'16px'" [styleClasses]="'tw-text-text-muted'" [tooltipPosition]="'top'"
                                    [tooltipText]="'Importing a dimension syncs active values from ' + appName + ' every 24 hours. Deactivated values in ' + appName + ' will also be disabled in ' + brandingConfig.brandName + ''">
                                </app-svg-icon>
                            </div>
                            <div class="tw-flex tw-justify-center" [ngClass]="{'!tw-mt-8-px': i!==0 || i===0 && appName !== AppName.INTACCT, 'tw-pt-2-px': i===0 && appName === AppName.INTACCT}">
                                <p-inputSwitch *ngIf="!isDestinationFixedImport" (onChange)="onShowWarningForDependentFields($event, expenseField)" [pTooltip]="isExpenseFieldDependent(expenseField.value) ? 'You cannot import dependent fields' : '' " (click)="updateDependentField(expenseField.value.source_field,expenseField.value.import_to_fyle)" formControlName="import_to_fyle" class="input-toggle-section"></p-inputSwitch>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="tw-pt-26-px" *ngIf="expenseField.value.source_field==='PROJECT' && expenseField.value.import_to_fyle && expenseField.value.destination_field === dependentDestinationValue" [formGroup]="form">
                    <div class="tw-flex">
                        <label class="container tw-pl-24-px tw-text-14-px">Import Cost Code and Cost Type from {{appName}} as dependent fields
                            <input type="checkbox" formControlName="isDependentImportEnabled">
                            <span class="checkmark"></span>
                        </label>
                    </div>
                    <div *ngIf="form.value.isDependentImportEnabled && dependentImportFields">
                        <div *ngFor="let dependentField of dependentImportFields; index as i" class="tw-flex tw-items-strat tw-pt-4" [ngClass]="[i ? 'tw-pl-20-px' : 'tw-pl-0-px']">
                            <div class="tw-pt-2-px">
                                <app-svg-icon [isTextColorAllowed]="true" [svgSource]="'line'" [width]="'21px'" [height]="'49px'" [styleClasses]="'tw-text-box-color'"></app-svg-icon>
                            </div>
                            <div>
                                <p class="tw-pl-16-px tw-mb-8-px tw-text-14-px tw-text-sub-text-color !tw-font-400">Dependent Field <app-mandatory-field></app-mandatory-field> </p>
                                <input type="text" [ngClass]="[i ? 'tw-w-240-px' : 'tw-w-260-px']" class="tw-text-14-px tw-text-text-secondary !tw-ml-20-px !tw-font-500 !tw-h-38-px !tw-px-14-px !tw-py-10-px tw-border tw-border-solid !tw-border-separator tw-rounded-4-px" value="{{dependentField.source_field}}" disabled>
                            </div>
                            <div class="tw-pt-44-px">
                                <app-svg-icon [isTextColorAllowed]="true" [svgSource]="'arrow-line'" [height]="'10px'" [width]="'100px'" [styleClasses]="'tw-text-box-color'"></app-svg-icon>
                            </div>
                            <div>
                                <p class="tw-mb-8-px tw-text-14-px tw-text-sub-text-color !tw-font-400">Fyle Field <app-mandatory-field></app-mandatory-field> </p>
                                <p-dropdown appendTo="body" class="tw-w-28-vw" [formControlName]="dependentField.formController" [options]="dependentField.options" optionLabel="attribute_type" placeholder="Select Expense Field" [disabled]="dependentField.isDisabled" [dropdownIcon]="'pi pi-chevron-down ' + brandingConfig.brandId">
                                    <ng-template let-option pTemplate="item">
                                        <div [ngClass]="{'custom-option': option.attribute_type === 'custom_field'}" class="tw-align-middle">
                                            <div class="tw-ml-0 tw-mr-6-px ">
                                                <app-svg-icon *ngIf="option.attribute_type === 'custom_field'" [svgSource]="'plus-square-medium'" [width]="'18px'" [height]="'18px'" ></app-svg-icon>
                                            </div>
                                            {{ option.display_name }}
                                        </div>
                                    </ng-template>
                                </p-dropdown>
                            </div>
                            <p-inputSwitch class="tw-pl-128-px input-toggle-section tw-pt-30-px" formControlName="dependentFieldImportToggle" [disabled]="true"></p-inputSwitch>
                        </div>
                    </div>
                </div>                      
                <div class="tw-text-alert-toast tw-pt-4 tw-pl-1" *ngIf="form.get('expenseFields')?.hasError('duplicatefyleFieldOptions') || form.get('expenseFields')?.hasError('duplicateaccountingFieldOptions')">
                    *{{brandingConfig.brandName}} and {{appName}} Fields should be unique.
                </div> 
            </div>  
        </div>
        <div *ngIf="showOrHideAddButton() && !isDestinationFixedImport" class="add-button-container">
            <app-svg-icon [svgSource]="'plus-square-medium'" [width]="'18px'" [height]="'18px'" [styleClasses]="'tw-cursor-pointer tw-text-mandatory-field-color'" (iconClick)="addExpenseField()"></app-svg-icon>
            <a class="add-row-text tw-pl-2" (click)="addExpenseField()">
                Add more fields
            </a>
        </div>                
    </div> 
</div>
