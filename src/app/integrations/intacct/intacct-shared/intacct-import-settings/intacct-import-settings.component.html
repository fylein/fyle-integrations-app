<div *ngIf="isLoading" class="tw-flex tw-justify-center tw-items-center tw-h-screen">
    <app-loader></app-loader>
</div>
<div *ngIf="!isLoading" class="configuration--contents tw-border-separator tw-mt-6">
    <div>
        <app-configuration-step-header 
        [headerText]="'Import Settings'"
        [contentText]="'In this section, you can choose the fields required to be imported from Sage Intacct to ' + brandingConfig.brandName + '.'"
        [redirectLink]="redirectLink"
        [showSyncButton]="isOnboarding"
        [appName]="appName"
        (refreshDimension)="refreshDimensions($event)"></app-configuration-step-header>
    </div>
    <form [formGroup]="importSettingsForm">
        <div class="tw-p-24-px">
            <div class="tw-mb-24-px tw-rounded-lg tw-border-separator tw-border tw-bg-configuration-bg">
                <app-configuration-step-sub-header
                    [label]="'Import Sage Intacct Dimensions'"
                    [subLabel]="'The Sage Intacct dimensions listed below will be mapped to their corresponding Fyle Field as shown below. Importing these dimensions from Sage Intacct to Fyle will make the values available as a dropdown in the expense form for your employees to choose from.'"
                    [showPreview]="true"
                    (isPreviewClick)="showPreviewDialog(true)">
                </app-configuration-step-sub-header>
                <div class="tw-px-24-px tw-pb-24-px">
                    <app-configuration-info-label
                        [infoText]="'This is a default mapping and you will not be able to modify it.'">
                    </app-configuration-info-label>
                </div>
            </div>
            <div>
                <app-configuration-import-field 
                    [form]="importSettingsForm" 
                    [appName]="appName" 
                    [defaultImportFields]="defaultImportFields"
                    (showWarningForDependentFields)="showWarningForDependentFields()">
                </app-configuration-import-field>
            </div>
        </div>
        <div class="tw-pl-18-px tw-pt-18-px" *ngIf="importSettingsForm.value?.importTaxCodes && isImportTaxVisible" [ngClass]="{'longerDropDown': importSettingsForm.value?.importTaxCodes && isImportTaxVisible}">
            <p-dropdown appendTo="body" [options]="sageIntacctTaxGroup" optionLabel="value" formControlName="sageIntacctTaxCodes" placeholder="Select Tax Group">
            </p-dropdown>
        </div>
        <div class="tw-p-24-px">
            <div class="tw-mb-24-px tw-rounded-lg tw-border-separator tw-border tw-bg-configuration-bg">
                <app-configuration-step-sub-header
                    [label]="'Import / Map Sage Intacct Dimensions'"
                    [subLabel]="'The Sage Intacct dimensions listed below can be mapped to an existing '+ brandingConfig.brandName +' field of your preference, or a new custom field. Importing these dimensions from Sage Intacct to '+ brandingConfig.brandName +' will make the values available as a dropdown in the expense form for your employees to choose from.'"
                    [showPreview]="true"
                    (isPreviewClick)="showPreviewDialog(true)">
                </app-configuration-step-sub-header>
                <div class="tw-px-24-px tw-pb-24-px">
                    <app-configuration-info-label
                        [infoText]="'If you\'d like to use only selective data from Sage Intacct, map a Sage Intacct dimension to a field in '+ brandingConfig.brandName +' and turn off the import, as importing the data will sync in all the active values in Sage Intacct. You can add the required values in '+ brandingConfig.brandName +' and map them later in the integration mapping section.'">
                    </app-configuration-info-label>
                </div>
            </div>
            <div>
                <app-configuration-import-field 
                    [form]="importSettingsForm" 
                    [appName]="appName" 
                    [costCategoryOption]="costTypeFieldOption" 
                    [costCodeFieldOption]="costCodeFieldOption" 
                    [accountingFieldOptions]="sageIntacctFields" 
                    [fyleFieldOptions]="fyleFields" 
                    [dependentImportFields]="dependentImportFields" 
                    [dependentDestinationValue] = "'PROJECT'"
                    (showWarningForDependentFields)="showWarningForDependentFields()">
                </app-configuration-import-field>
            </div>
        </div>
        <div>
            <app-configuration-step-footer [ctaText] = "!saveInProgress ? (isOnboarding ? ConfigurationCtaText.SAVE_AND_CONTINUE : ConfigurationCtaText.SAVE) : ConfigurationCtaText.SAVING" (save)="save()" [isButtonDisabled]="!importSettingsForm.valid"></app-configuration-step-footer>
        </div>
    </form>
    <div>
        <app-configuration-custom-field-creation-dialog 
            [customFieldForm]="customFieldForm"
            [showCustomFieldCreationDialog]="showDialog" 
            (saveCustomFieldFn)="saveCustomField()"
            (closeModelFn)="closeModel()">
        </app-configuration-custom-field-creation-dialog>
    </div>
</div>

<div>
    <app-configuration-confirmation-dialog 
        (warningAccepted)="acceptDependentFieldWarning($event)"
        [isWarningVisible]="showDependentFieldWarning" 
        [headerText]="'Warning'"
        [contextText]="'You have imported Cost codes and Cost Types from Sage Intacct by mapping them to fields in ' + brandingConfig.brandName + '. By turning off the import, you would lose the mappings you\'ve established for these fields.'"
        [confirmBtnText]="'Continue'">
    </app-configuration-confirmation-dialog>
</div>

<div *ngIf="isDialogVisible">
    <app-preview-dialog 
        [isPreviewDialogVisible]="true"
        [iconPath]="'assets/illustrations/sageIntacct/IntacctImportSettings.png'" (closeDialog)="closeDialog()"
        [header]="'Preview'">
    </app-preview-dialog>
</div>