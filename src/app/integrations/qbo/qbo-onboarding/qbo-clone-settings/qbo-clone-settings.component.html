<app-onboarding-steppers [isCloneSettingView]="true" [onboardingSteps]="onboardingSteps"></app-onboarding-steppers>
<div *ngIf="isLoading" class="tw-flex tw-justify-center tw-items-center tw-pt-80-px">
    <app-loader></app-loader>
</div>

<div *ngIf="!isLoading" class="clone-setting configuration--contents tw-border-1-px tw-border-box-color tw-mt-24-px">
    <app-clone-setting-header [headerText]="'Employee Mapping'" [subHeaderText]="'Choose appropriate representation of your Employees in QuickBooks Online'"></app-clone-setting-header>

    <div class="clone-setting--field-section">
        <div class="clone-setting--field">
            <app-clone-setting-field
                [iconSource]="'user-two'"
                [label]="'How are your Employees represented in QuickBooks Online?'"
                [options]="employeeMappingOptions"
                [placeholder]="'Select representation'"
                [form]="employeeSettingForm"
                [isFieldMandatory]="true"
                [formControllerName]="'employeeMapping'"
                [dropdownDisplayKey]="'label'">
            </app-clone-setting-field>
        </div>

        <div class="clone-setting--field">
            <app-clone-setting-field
                [iconSource]="'question-square-outline'"
                [label]="'How should Employees in ' + brandingConfig.brandName + ' be matched to Employees/Vendors in QuickBooks Online?'"
                [options]="autoMapEmployeeOptions"
                [placeholder]="'Select representation'"
                [form]="employeeSettingForm"
                [isFieldMandatory]="false"
                [formControllerName]="'autoMapEmployee'"
                [dropdownDisplayKey]="'label'">
            </app-clone-setting-field>
        </div>
    </div>

    <app-clone-setting-header [headerText]="'Export Settings'" [subHeaderText]="'In this section, you can configure how and when expenses from ' + brandingConfig.brandName + ' should be exported to QuickBooks Online.'"></app-clone-setting-header>
    <div [formGroup]="exportSettingForm" class="clone-setting--field-section">
        <div class="clone-setting--field">
            <div class="clone-setting--export-setting-header">
                <div>
                    Export Reimbursable Expenses
                </div>
                <div>
                    <p-inputSwitch formControlName="reimbursableExpense"></p-inputSwitch>
                </div>
            </div>
        </div>

        <div *ngIf="exportSettingForm.value?.reimbursableExpense" class="clone-setting--field">
            <app-clone-setting-field
                [iconSource]="'list'"
                [label]="'How should the expenses be exported?'"
                [options]="reimbursableExportTypes"
                [placeholder]="'Choose the type of transaction in QuickBooks Online to export your ' + brandingConfig.brandName +' expenses'"
                [form]="exportSettingForm"
                [isFieldMandatory]="false"
                [formControllerName]="'reimbursableExportType'"
                [dropdownDisplayKey]="'label'">
            </app-clone-setting-field>

            <div class="clone-setting--dependent-field">
                <app-clone-setting-field *ngIf="helperService.isFieldRequired(exportSettingForm, 'bankAccount')"
                    [label]="'To which Bank Account should the ' + (exportSettingForm.value.reimbursableExportType | snakeCaseToSpaceCase | titlecase) + ' be posted to?'"
                    [options]="bankAccounts"
                    [placeholder]="'Select bank account'"
                    [form]="exportSettingForm"
                    [isFieldMandatory]="true"
                    [formControllerName]="'bankAccount'"
                    [dropdownDisplayKey]="'name'">
                </app-clone-setting-field>

                <app-clone-setting-field *ngIf="helperService.isFieldRequired(exportSettingForm, 'qboExpenseAccount')"
                    [label]="'To which Expense Account should the ' + (exportSettingForm.value.reimbursableExportType | snakeCaseToSpaceCase | titlecase) + ' be posted to?'"
                    [options]="expenseAccounts"
                    [placeholder]="'Select Expense account'"
                    [form]="exportSettingForm"
                    [isFieldMandatory]="true"
                    [formControllerName]="'qboExpenseAccount'"
                    [dropdownDisplayKey]="'name'">
                </app-clone-setting-field>

                <app-clone-setting-field *ngIf="(exportSettingForm.controls.reimbursableExportType.value === QBOReimbursableExpensesObject.BILL || (exportSettingForm.controls.reimbursableExportType.value === QBOReimbursableExpensesObject.JOURNAL_ENTRY && exportSettingForm.value.employeeMapping === EmployeeFieldMapping.VENDOR))"
                    [label]="'To which Accounts Payable account should the ' + (exportSettingForm.value.reimbursableExportType | snakeCaseToSpaceCase | titlecase) + ' be posted to?'"
                    [options]="accountsPayables"
                    [placeholder]="'Select accounts payable'"
                    [form]="exportSettingForm"
                    [isFieldMandatory]="true"
                    [formControllerName]="'accountsPayable'"
                    [dropdownDisplayKey]="'name'">
                </app-clone-setting-field>
            </div>
        </div>

        <div class="clone-setting--field">
            <app-clone-setting-field *ngIf="exportSettingForm.value.reimbursableExportType"
                [iconSource]="'list'"
                [label]="'At which state should the expenses be ready to export from ' + brandingConfig.brandName + '?'"
                [options]="expenseStateOptions"
                [placeholder]="'Select export state'"
                [form]="exportSettingForm"
                [isFieldMandatory]="true"
                [formControllerName]="'expenseState'"
                [dropdownDisplayKey]="'label'">
            </app-clone-setting-field>
        </div>

        <div class="clone-setting--field">
            <app-clone-setting-field *ngIf="exportSettingForm.value.reimbursableExportType"
                [iconSource]="'list'"
                [label]="'How should the expenses be grouped?'"
                [options]="expenseGroupByOptions"
                [placeholder]="'Select expense grouping'"
                [form]="exportSettingForm"
                [isFieldMandatory]="true"
                [formControllerName]="'reimbursableExportGroup'"
                [dropdownDisplayKey]="'label'">
            </app-clone-setting-field>
        </div>

        <div class="clone-setting--field">
            <app-clone-setting-field *ngIf="exportSettingForm.value.reimbursableExportType"
                [iconSource]="'list'"
                [label]="'Set the ' + (exportSettingForm.value.reimbursableExportType | snakeCaseToSpaceCase | titlecase) + ' date as'"
                [options]="reimbursableExpenseGroupingDateOptions"
                [placeholder]="'Select export date'"
                [form]="exportSettingForm"
                [isFieldMandatory]="true"
                [formControllerName]="'reimbursableExportDate'"
                [dropdownDisplayKey]="'label'">
            </app-clone-setting-field>
        </div>
    </div>

    <div [formGroup]="exportSettingForm" class="clone-setting--field-section">
        <div class="clone-setting--field">
            <div class="clone-setting--export-setting-header">
                <div>
                    Export Corporate Credit Card Expenses
                </div>
                <div>
                    <p-inputSwitch formControlName="creditCardExpense"></p-inputSwitch>
                </div>
            </div>
        </div>

        <div *ngIf="exportSettingForm.value?.creditCardExpense" class="clone-setting--field">
            <app-clone-setting-field
                [iconSource]="'list'"
                [label]="'How should the expenses be exported?'"
                [options]="creditCardExportTypes"
                [placeholder]="'Choose the type of transaction in QuickBooks Online to export your ' + brandingConfig.brandName +' expenses'"
                [form]="exportSettingForm"
                [isFieldMandatory]="false"
                [formControllerName]="'creditCardExportType'"
                [dropdownDisplayKey]="'label'">
            </app-clone-setting-field>

            <div class="clone-setting--dependent-field">
                <app-clone-setting-field *ngIf="showNameInJournalOption"
                    [label]="'Name in Journal Entry (CCC)'"
                    [options]="nameInJournalOptions"
                    [placeholder]="'Select a name'"
                    [form]="exportSettingForm"
                    [isFieldMandatory]="false"
                    [formControllerName]="'nameInJournalEntry'"
                    [dropdownDisplayKey]="'label'">
                </app-clone-setting-field>

                <app-clone-setting-field *ngIf="helperService.isFieldRequired(exportSettingForm, 'defaultCCCAccount')"
                    [label]="'Set Default Credit Card Account as'"
                    [options]="expenseAccounts"
                    [placeholder]="'Select Default Credit Card Account'"
                    [form]="exportSettingForm"
                    [isFieldMandatory]="true"
                    [formControllerName]="'defaultCCCAccount'"
                    [dropdownDisplayKey]="'name'">
                </app-clone-setting-field>

                <app-clone-setting-field *ngIf="helperService.isFieldRequired(exportSettingForm, 'defaultDebitCardAccount')"
                    [label]="'Set Default Debit Card Account as'"
                    [options]="accountsPayables"
                    [placeholder]="'Select Default Debit Card Account'"
                    [form]="exportSettingForm"
                    [isFieldMandatory]="true"
                    [formControllerName]="'defaultDebitCardAccount'"
                    [dropdownDisplayKey]="'name'">
                </app-clone-setting-field>

                <app-clone-setting-field *ngIf="helperService.isFieldRequired(exportSettingForm, 'defaultCreditCardVendor')"
                    [label]="'Set default corporate Card Vendor as'"
                    [options]="vendors"
                    [placeholder]="'Select default corporate card vendor'"
                    [form]="exportSettingForm"
                    [isFieldMandatory]="true"
                    [formControllerName]="'defaultCreditCardVendor'"
                    [dropdownDisplayKey]="'name'">
                </app-clone-setting-field>

                <app-clone-setting-field *ngIf="(exportSettingForm.value.creditCardExportType === QBOCorporateCreditCardExpensesObject.BILL) && !((exportSettingForm.controls.reimbursableExportType.value === QBOReimbursableExpensesObject.BILL || (exportSettingForm.controls.reimbursableExportType.value === QBOReimbursableExpensesObject.JOURNAL_ENTRY && exportSettingForm.value.employeeMapping === EmployeeFieldMapping.VENDOR)))"
                    [label]="'To which Accounts Payable account should the ' + (exportSettingForm.value.creditCardExportType | snakeCaseToSpaceCase | titlecase) + ' be posted to?'"
                    [options]="accountsPayables"
                    [placeholder]="'Select accounts payable'"
                    [form]="exportSettingForm"
                    [isFieldMandatory]="true"
                    [formControllerName]="'accountsPayable'"
                    [dropdownDisplayKey]="'name'">
                </app-clone-setting-field>
            </div>
        </div>

        <div class="clone-setting--field">
            <app-clone-setting-field *ngIf="exportSettingForm.value.creditCardExportType"
                [iconSource]="'list'"
                [label]="'At which state should the expenses be ready to export from ' + brandingConfig.brandName + '?'"
                [options]="expenseStateOptions"
                [placeholder]="'Select CCC expense state'"
                [form]="exportSettingForm"
                [isFieldMandatory]="true"
                [formControllerName]="'cccExpenseState'"
                [dropdownDisplayKey]="'label'">
            </app-clone-setting-field>
        </div>

        <div class="clone-setting--field">
            <app-clone-setting-field *ngIf="exportSettingForm.value.creditCardExportType"
                [iconSource]="'list'"
                [label]="'How should the expenses be grouped?'"
                [options]="expenseGroupByOptions"
                [placeholder]="'Select expense grouping'"
                [form]="exportSettingForm"
                [isFieldMandatory]="true"
                [formControllerName]="'creditCardExportGroup'"
                [dropdownDisplayKey]="'label'">
            </app-clone-setting-field>
        </div>

        <div class="clone-setting--field">
            <app-clone-setting-field *ngIf="exportSettingForm.value.creditCardExportType"
                [iconSource]="'list'"
                [label]="'Set the ' + (exportSettingForm.value.creditCardExportType | snakeCaseToSpaceCase | titlecase) + ' date as'"
                [options]="cccExpenseGroupingDateOptions"
                [placeholder]="'Select export date'"
                [form]="exportSettingForm"
                [isFieldMandatory]="true"
                [formControllerName]="'creditCardExportDate'"
                [dropdownDisplayKey]="'label'">
            </app-clone-setting-field>
        </div>
    </div>

    <app-clone-setting-header [headerText]="'Import Settings'" [subHeaderText]="'In this section, you can configure how the dimensions you import from QuickBooks Online should be mapped in ' + brandingConfig.brandName"></app-clone-setting-header>

    <div class="clone-setting--field-section">
        <div class="clone-setting--field">
            <app-clone-setting-field
                [iconSource]="'arrow-tail-up-down'"
                [label]="'Import Charts of Accounts from QuickBooks Online'"
                [form]="importSettingForm"
                [formControllerName]="'importCategories'"
                [inputType]="InputType.TOGGLE">
            </app-clone-setting-field>

            <div class="clone-setting--dependent-field">
                <app-clone-setting-field *ngIf="importSettingForm.value.importCategories"
                    [label]="'Select the accounts from QuickBooks Online to import as categories'"
                    [options]="chartOfAccountTypesList"
                    [placeholder]="'Select Chart of Accouts'"
                    [form]="importSettingForm"
                    [isFieldMandatory]="true"
                    [formControllerName]="'chartOfAccountTypes'"
                    [disabledOption]="'Expense'"
                    [inputType]="InputType.MULTI_SELECT">
                </app-clone-setting-field>
            </div>
        </div>

        <div class="clone-setting--field" *ngIf="cloneSetting.export_settings.workspace_general_settings.reimbursable_expenses_object !== QBOReimbursableExpensesObject.JOURNAL_ENTRY && cloneSetting.export_settings.workspace_general_settings.corporate_credit_card_expenses_object !== QBOCorporateCreditCardExpensesObject.JOURNAL_ENTRY">
            <app-clone-setting-field
                [iconSource]="'arrow-tail-up-down'"
                [label]="'Import Products/Services from QuickBooks Online'"
                [form]="importSettingForm"
                [formControllerName]="'importItems'"
                [inputType]="InputType.TOGGLE">
            </app-clone-setting-field>
        </div>

        <div class="clone-setting--field" *ngIf="isTaxGroupSyncAllowed">
            <app-clone-setting-field
                [iconSource]="'arrow-tail-up-down'"
                [label]="'Import Tax from QuickBooks Online'"
                [form]="importSettingForm"
                [formControllerName]="'taxCode'"
                [inputType]="InputType.TOGGLE">
            </app-clone-setting-field>

            <div class="clone-setting--dependent-field" *ngIf="importSettingForm.value.taxCode">
                <app-clone-setting-field *ngIf="importSettingForm.value.importCategories"
                    [label]="'Select Default Tax Code'"
                    [options]="taxCodes"
                    [placeholder]="'Select tax code'"
                    [form]="importSettingForm"
                    [isFieldMandatory]="true"
                    [formControllerName]="'defaultTaxCode'"
                    [dropdownDisplayKey]="'name'">
                </app-clone-setting-field>
            </div>
        </div>

        <div class="clone-setting--field" *ngIf="isImportMerchantsAllowed">
            <app-clone-setting-field
                [iconSource]="'arrow-tail-up-down'"
                [label]="'Import Vendors from QuickBooks Online'"
                [form]="importSettingForm"
                [formControllerName]="'importVendorsAsMerchants'"
                [inputType]="InputType.TOGGLE">
            </app-clone-setting-field>
        </div>

        <app-configuration-import-field
            [form]="importSettingForm"
            [appName]="appName"
            [accountingFieldOptions]="qboFields"
            [fyleFieldOptions]="fyleFields"
            [isDestinationFixedImport]="true"
            [isCloneSettingView]="true">
        </app-configuration-import-field>
    </div>

    <app-clone-setting-header [headerText]="'Advanced Settings'" [subHeaderText]="'In this section,  you can configure settings to automate and customize your expense exports'"></app-clone-setting-header>
    <div class="clone-setting--field-section">
        <div class="clone-setting--field">
            <app-clone-setting-field
                [iconSource]="'calendar'"
                [label]="'Schedule automatic export'"
                [form]="advancedSettingForm"
                [formControllerName]="'exportSchedule'"
                [inputType]="InputType.TOGGLE">
            </app-clone-setting-field>

            <div class="clone-setting--dependent-field tw-flex" *ngIf="advancedSettingForm.value.exportSchedule">
                <app-clone-setting-field class="tw-flex-auto"
                    [label]="'Set up export frequency'"
                    [isFieldMandatory]="true"
                    [options]="scheduleIntervalHours"
                    [form]="advancedSettingForm"
                    [isFieldMandatory]="true"
                    [formControllerName]="'exportScheduleFrequency'"
                    [dropdownDisplayKey]="'label'"
                    [additionalClasses]="'dropdown-size-schedule'">
                </app-clone-setting-field>
                <div class="tw-ml-16-px">
                    <input type="text" class="tw-border-box-color !tw-w-100-px !tw-h-40-px !tw-bg-disabled-bg-color tw-text-slightly-normal-text-color" pInputText disabled [value]="advancedSettingForm.value.exportScheduleFrequency > 1 ? 'Hours' : 'Hour'">
                </div>
            </div>

            <div class="clone-setting--dependent-field tw-flex tw-justify-between" *ngIf="advancedSettingForm.value.exportSchedule">
                <p class="tw-pl-40-px tw-py-2-px tw-text-slightly-normal-text-color tw-text-14-px">Send Error Notification to</p>
                <app-email-multi-select-field
                    [form]="advancedSettingForm"
                    [label]="'Send Error Notification to'"
                    [isFieldMandatory]="false"
                    [mandatoryErrorListName]="'email for error notification'"
                    [subLabel]="'Select or add an email address to notify upon import failure or integration error.'"
                    [options]="adminEmails"
                    [iconPath]="'expense'"
                    [placeholder]="'Select email address'"
                    [formControllerName]="'email'"
                    [isCloneSettingView]="true">
                </app-email-multi-select-field>
            </div>
        </div>

        <div class="clone-setting--field">
            <app-clone-setting-field
                [iconSource]="'calendar'"
                [label]="'Post entries in the next open accounting period'"
                [form]="advancedSettingForm"
                [formControllerName]="'changeAccountingPeriod'"
                [inputType]="InputType.TOGGLE">
            </app-clone-setting-field>
        </div>

        <div class="clone-setting--field" *ngIf="isAutoCreateVendorsFieldVisible()">
            <app-clone-setting-field
                [iconSource]="'user-plus'"
                [label]="'Auto-Create Vendors'"
                [form]="advancedSettingForm"
                [formControllerName]="'autoCreateVendors'"
                [inputType]="InputType.TOGGLE">
            </app-clone-setting-field>
        </div>

        <div class="clone-setting--field" *ngIf="isPaymentSyncFieldVisible()">
            <app-clone-setting-field
                [iconSource]="'arrow-rotate'"
                [label]="'Auto Sync payment status for reimbursable expenses'"
                [form]="advancedSettingForm"
                [formControllerName]="'paymentSync'"
                [options]="paymentSyncOptions"
                [placeholder]="'Select how payments should be synced for reimbursable expenses'"
                [dropdownDisplayKey]="'label'">
            </app-clone-setting-field>

            <div class="clone-setting--dependent-field" *ngIf="advancedSettingForm.value.paymentSync && advancedSettingForm.value.paymentSync === 'fyle_to_qbo'">
                <app-clone-setting-field
                    [label]="'To which Payment account should the payment entries be posted?'"
                    [options]="billPaymentAccounts"
                    [placeholder]="'Select a Payment Account'"
                    [form]="advancedSettingForm"
                    [isFieldMandatory]="true"
                    [formControllerName]="'billPaymentAccount'"
                    [dropdownDisplayKey]="'name'">
                </app-clone-setting-field>
            </div>
        </div>

        <div class="clone-setting--field" *ngIf="isSingleCreditLineJEFieldVisible()">
            <app-clone-setting-field
                [iconSource]="'list'"
                [label]="'Create a single itemized offset credit entry for Journal'"
                [form]="advancedSettingForm"
                [formControllerName]="'singleCreditLineJE'"
                [inputType]="InputType.TOGGLE">
            </app-clone-setting-field>
        </div>

        <div class="clone-setting--field" *ngIf="isAutoCreateMerchantsAsVendorsFieldVisible()">
            <app-clone-setting-field
                [iconSource]="'user-plus'"
                [label]="'Auto-create Merchants as Vendors'"
                [form]="advancedSettingForm"
                [formControllerName]="'autoCreateMerchantsAsVendors'"
                [inputType]="InputType.TOGGLE">
            </app-clone-setting-field>
        </div>

        <div class="clone-setting--field">
            <div class="tw-flex tw-justify-between">
                <div class="tw-flex">
                    <svg-icon-sprite width="24px" height="24px" src="list" class="tw-text-menu-inactive-text-color"></svg-icon-sprite>
                    <p class="tw-pl-16-px tw-py-2-px tw-text-slightly-normal-text-color tw-text-14-px">
                        Set the Description Field in QuickBooks Online
                    </p>
                </div>
                <app-configuration-multi-select
                    [form]="advancedSettingForm"
                    [isFieldMandatory]="false"
                    [mandatoryErrorListName]="'Item level description'"
                    [label]="'Set the line item-level Description Field in QuickBooks Online'"
                    [subLabel]="'You can choose from a list of available data points that you\'d like to export to the description field in QuickBooks Online and re-order them as per your requirement.'"
                    [options]="defaultMemoOptions"
                    [iconPath]="'expense'"
                    [placeholder]="'Set description'"
                    [formControllerName]="'memoStructure'"
                    [isCloneSettingView]="true">
                </app-configuration-multi-select>
            </div>
            <div class="clone-setting--dependent-field tw-text-14-px tw-font-400 tw-text-faded-text-color !tw-pl-40-px">
                <h4 class="tw-mb-12-px">Preview of the Description Field</h4>
                <div class="preview-box">
                    {{memoPreviewText}}
                </div>
            </div>
        </div>
    </div>
</div>
