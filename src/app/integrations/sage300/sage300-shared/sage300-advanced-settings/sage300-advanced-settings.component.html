<div *ngIf="isLoading" class="tw-flex tw-justify-center tw-items-center tw-h-screen">
    <app-loader></app-loader>
</div>
<div *ngIf="!isLoading" class="configuration--contents tw-border-separator tw-mt-6">
    <div>
        <app-configuration-step-header 
            [headerText]="'Advanced Settings'"
            [contentText]="'In this section, you can customize the integration based on your accounting requirements. '"
            [redirectLink]="supportArticleLink"
            [showSyncButton]="isOnboarding"
            [appName]="appName"
            (refreshDimension)="refreshDimensions($event)">
        </app-configuration-step-header>
    </div>
    <form [formGroup]="advancedSettingForm">
        <div class="tw-p-24-px">
            <div class="tw-mb-16-px">
                <div class="tw-rounded-lg tw-border-separator tw-border tw-bg-configuration-bg tw-p-24-px">
                    <h4 class="tw-text-normal-text-color tw-font-500">
                        Automation
                    </h4>
                    <h5 class="tw-text-faded-text-color tw-text-14-px tw-pt-8-px !tw-font-400">
                        You can automate the export and sync of your data in this section.
                    </h5>
                </div>
            </div>
            <div class="tw-mb-16-px">
                <div class="tw-rounded-12-px tw-border-separator tw-border tw-bg-white tw-mb-16-px">
                    <app-configuration-toggle-field 
                        [form]="advancedSettingForm"
                        [label]="'Schedule automatic export'" 
                        [subLabel]="'Set up a schedule to frequently automate the export of expenses from Fyle to QuickBooks Desktop.'" 
                        [formControllerName]="'scheduleEnabled'"
                        [iconPath]="'calender'">
                    </app-configuration-toggle-field>
                    <div *ngIf="advancedSettingForm.value.scheduleEnabled">
                        <app-configuration-select-field
                            [form]="advancedSettingForm"
                            [isFieldMandatory]="false"
                            [mandatoryErrorListName]="'automatic export method'"
                            [label]="'Set up export frequency'"
                            [subLabel]="'Set a frequency based on how often you want your expenses in Fyle to be exported to Sage 300 CRE'"
                            [options]="hours"
                            [showClearIcon]="true"
                            [placeholder]="'Set Schedule'"
                            [formControllerName]="'scheduleAutoExportFrequency'">
                        </app-configuration-select-field>
                        <app-email-multi-select-field
                            [form]="advancedSettingForm"
                            [label]="'Send Error Notification to'"
                            [isFieldMandatory]="false"
                            [mandatoryErrorListName]="'email for error notification'"
                            [subLabel]="'Select or add an email address to notify upon import failure or integration error.'"
                            [options]="adminEmails"
                            [placeholder]="'Select email address'"
                            [formControllerName]="'email'">
                        </app-email-multi-select-field>
                    </div>
                </div>
                <div *ngIf="isReimbursableExpense" class="tw-rounded-12-px tw-border-separator tw-border tw-bg-white">
                    <app-configuration-toggle-field 
                        [form]="advancedSettingForm"
                        [label]="'Auto-Sync Payment Status for Reimbursable Expenses'" 
                        [subLabel]="'You can set the preference based on whether you\â€™re handing the payments for your employees within Fyle or outside Fyle.'" 
                        [formControllerName]="'syncSage300ToFylePayments'"
                        [iconPath]="'synced'">
                    </app-configuration-toggle-field>
                    <div *ngIf="advancedSettingForm.value.syncSage300ToFylePayments">
                        <app-configuration-select-field
                            [form]="advancedSettingForm"
                            [isFieldMandatory]="false"
                            [mandatoryErrorListName]="'payment account'"
                            [label]="'To which Payment Account should the expenses be posted to?'"
                            [subLabel]="'To post Expense Reports in Sage 300 CRE, a Payment Account is required. Reimbursable expenses will be posted to the account configured here.'"
                            [options]="hours"
                            [showClearIcon]="true"
                            [iconPath]="'questionmark'"
                            [placeholder]="'Select payment account'"
                            [formControllerName]="'defaultJobName'">
                        </app-configuration-select-field>
                    </div>
                </div>
            </div>
            <div class="tw-mb-16-px">
                <div class="tw-rounded-lg tw-border-separator tw-border tw-bg-configuration-bg tw-p-24-px">
                    <h4 class="tw-text-normal-text-color tw-font-500">
                        Customization
                    </h4>
                    <h5 class="tw-text-faded-text-color tw-text-14-px tw-pt-8-px !tw-font-400">
                        In this section, you can customize the data that you'd like to export from Fyle to Sage 300 CRE. You can choose what data points need to be exported and what shouldn't be.
                    </h5>
                </div>
            </div>
            <div class="tw-rounded-12-px tw-border-separator tw-border tw-bg-white tw-mb-16-px">
                <app-configuration-select-field
                    [form]="advancedSettingForm"
                    [isFieldMandatory]="false"
                    [mandatoryErrorListName]="'Top level description'"
                    [label]="'Set the top-level Description Field in Sage 300 CRE'"
                    [subLabel]="'You can choose from a list of available data points that you\'d like to export to the description field in Sage 300 CRE and re-order them as per your requirement.'"
                    [options]="hours"
                    [showClearIcon]="true"
                    [iconPath]="'expense'"
                    [placeholder]="'Set description'"
                    [formControllerName]="'topLevelMemo'">
                </app-configuration-select-field>
                <div class="preview-text preview-section">
                    <h4 class="tw-mb-12-px">Preview of the Description Field</h4>
                    <div class="preview-box">
                        {{advancedSettingForm.value.topLevelMemo}}lkjljlkl
                    </div>
                </div>
            </div>
            <div class="tw-rounded-12-px tw-border-separator tw-border tw-bg-white tw-mb-16-px">
                <app-configuration-toggle-field 
                    [form]="advancedSettingForm"
                    [label]="'Skip export of specific expenses from Fyle to Sage 300 CRE'" 
                    [subLabel]="'You could choose to skip expenses from Fyle to Sage 300 CRE by setting up a conditional rule.'" 
                    [formControllerName]="'skipExport'"
                    [iconPath]="'expense'"
                    [redirectLink]="'jhjh'">
                </app-configuration-toggle-field>
                <div *ngIf="advancedSettingForm.value.skipExport">
                    <app-configuration-skip-export
                    [enableSkipExport]="advancedSettingForm.value.skipExport"
                    [skipExportForm]="skipExportForm"
                    [expenseFilter]="expenseFilters"
                    (deleteSkipExportForm)="deleteExpenseFilter($event)">
                    </app-configuration-skip-export>
                </div>
            </div>
            <div class="tw-mb-16-px">
                <div class="tw-rounded-lg tw-border-separator tw-border tw-bg-configuration-bg tw-p-24-px">
                    <h4 class="tw-text-normal-text-color tw-font-500">
                        Other Preferences
                    </h4>
                    <h5 class="tw-text-faded-text-color tw-text-14-px tw-pt-8-px !tw-font-400">
                        Based on your preference, you can choose whether you want to create any new records in Sage 300 CRE from Fyle. (when there is no employee record found, or when the accounting period is closed)
                    </h5>
                </div>
            </div>
            <div class="tw-rounded-12-px tw-border-separator tw-border tw-bg-white">
                <app-configuration-toggle-field 
                    [form]="advancedSettingForm"
                    [label]="'Auto-Create Vendor'" 
                    [subLabel]="'When matching Vendor record is not found for an employee in Fyle, the integration will auto-create a new record in Sage 300 CRE.'" 
                    [formControllerName]="'autoCreateMerchantDestinationEntity'"
                    [iconPath]="'people'">
                </app-configuration-toggle-field>
            </div>
        </div>
        <div>
            <app-configuration-step-footer [ctaText] = "!isSaveInProgress ? (isOnboarding ? ConfigurationCtaText.SAVE_AND_CONTINUE : ConfigurationCtaText.SAVE) : ConfigurationCtaText.SAVING" (save)="save()" [isButtonDisabled]="!advancedSettingForm.valid"></app-configuration-step-footer>
        </div>
    </form>
</div>
