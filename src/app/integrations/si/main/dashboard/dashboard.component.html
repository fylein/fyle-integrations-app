<div class="tw-absolute tw-bg-header-1 tw-h-110-px tw-w-[100%] tw-z-[-1]"></div>
<div class="tw-absolute tw-bg-header-2 tw-h-110-px tw-w-[100%] tw-z-[-1]"></div>

<div *ngIf="isLoading" class="tw-flex tw-justify-center tw-items-center tw-h-screen">
    <app-loader></app-loader>
</div>

<div *ngIf="!importInProgress && !isLoading" class="tw-py-40-px tw-px-120-px">
    <div class="tw-shadow-app-card tw-rounded-12-px tw-bg-white tw-border-1-px tw-border-separator">
        <div class="tw-p-24-px">
            <div class="tw-flex tw-justify-between tw-items-center ">
                <div class="tw-w-3/5">
                    <h3 *ngIf="!exportInProgress && !exportableExpenseGroupIds.length" class="tw-text-18-px tw-font-500 tw-text-slightly-normal-text-color">Sit back and relax!</h3>
                    <h3 *ngIf="exportInProgress">Exporting {{ processedCount }} of {{ exportableExpenseGroupIds.length }} Transaction{{exportableExpenseGroupIds.length > 1 ? 's' : ''}} to Sage Intacct</h3>
                    <h3 *ngIf="!exportInProgress && exportableExpenseGroupIds.length">{{ exportableExpenseGroupIds.length }} Transaction{{exportableExpenseGroupIds.length > 1 ? 's' : ''}} ready to export</h3>
                    <h5 *ngIf="!exportInProgress && !exportableExpenseGroupIds.length" class="tw-text-14-px tw-font-400 tw-text-slightly-normal-text-color tw-pt-2-px">No new expenses to export in the configured state of export in Fyle. Once you start processing payments or closing your expenses, they will be automatically available here.</h5>
                    <h5 *ngIf="!exportInProgress && exportableExpenseGroupIds.length" class="tw-text-14-px tw-font-400 tw-text-slightly-normal-text-color tw-pt-2-px">Click on <b>Export</b> to start exporting expenses from Fyle as QuickBooks Online transactions.</h5>
                    <h5 *ngIf="exportInProgress">This may take a few minutes. Please wait...</h5>
                    <div *ngIf="!exportInProgress && failedExpenseGroupCount !== null && failedExpenseGroupCount > 0" fxLayout="row">
                        <h5>{{ exportableExpenseGroupIds.length - failedExpenseGroupCount > 0 ? exportableExpenseGroupIds.length - failedExpenseGroupCount : 0 }} new Transaction{{(exportableExpenseGroupIds.length - failedExpenseGroupCount) > 1 ? 's' : ''}}, {{ failedExpenseGroupCount }} previously failed Transaction{{failedExpenseGroupCount > 1 ? 's' : ''}}</h5>
                    </div>
                </div>
                <div class="tw-flex tw-items-end tw-justify-end">
                    <div>
                        <button type="button" class="export-btn tw-float-right tw-flex tw-justify-end tw-items-center tw-text-white tw-text-500 tw-px-24-px tw-py-12-px tw-bg-mandatory-field-color tw-rounded-4-px" (click)="export()" [ngClass]="!exportableExpenseGroupIds.length || exportInProgress ? 'btn-disabled' : 'btn-enabled'" [disabled]="exportInProgress">
                            <p class="tw-text-14-px tw-font-400 tw-pl-5px" *ngIf="!exportInProgress">Export
                                <i class="tw-pl-10-px tw-pt-2-px !tw-text-12-px pi pi-arrow-right"></i>
                            </p>
                            <p class="tw-text-14-px tw-font-400 tw-pl-5px" *ngIf="exportInProgress">Exporting ...
                            </p>
                        </button><br>
                    </div>
                </div>
            </div>
        </div>
        <div  *ngIf="exportInProgress">
            <p-progressBar class="!tw-h-6-px" [value]="exportProgressPercentage" [showValue]='false'></p-progressBar>
        </div>
    </div>
    <div *ngIf="false" class="tw-flex tw-justify-center tw-items-center tw-pt-36">
        <div class="tw-text-center">
          <img class="tw-pr-4" src="assets/icons/dashboard-illustration.svg" alt="">
          <p class="tw-pt-8 tw-font-300">There are no expenses to export at the moment!</p>
        </div>
      </div>
    <div *ngIf="true" class="tw-mt-40-px tw-shadow-app-card tw-rounded-12-px tw-bg-white tw-border-1-px tw-border-separator">
        <div class="tw-flex tw-justify-between tw-items-center tw-p-24-px">
                <h4 class="tw-font-500">Your Last Export</h4>
        </div>
        <div class="tw-border-separator tw-border-1-px">
            <div *ngIf="true" class="tw-p-10 tw-rounded-6-px tw-bg-white">
                <div *ngIf="true" class="inside-container tw-mt-10-px tw-p-10 tw-rounded-6-px tw-bg-white">
                    <div class="tw-flex tw-items-center">
                        <img src="assets/icons/green-tick.svg" alt="Success Icon" class="tw-mr-2">
                        Successful Expenses
                        <span class="tw-ml-24 tw-pl-8-px">
                            {{ lastExport?.successful_expense_groups_count | number:'2.0-0' }}
                        </span>                          
                        <a href="#" class="tw-ml-4 tw-text-pink">View</a>
                        <div class="tw-ml-auto tw-flex tw-flex-col">
                            <span>
                                Last Export at: 
                                {{ lastExport ? (lastExport.last_exported_at | date: 'h:mm a,') : 'None' }}
                                {{ lastExport ? (lastExport.last_exported_at | date: 'dd MMM yyyy') : '' }}
                            </span>                              
                        </div>
                    </div>
                    <div class="tw-flex tw-items-center">
                        <img src="assets/icons/red-error.svg" alt="Error Icon" class="tw-mr-2">
                        Failed Expenses <span class="tw-ml-32 tw-pl-10-px">{{ lastExport?.failed_expense_groups_count | number:'2.0-0' }}</span> 
                        <a href="#" class="tw-ml-4 tw-text-pink">View</a>
                        <div class="tw-ml-auto tw-flex tw-flex-col">
                            <span>
                                Next Export at: 
                                {{ lastExport?.next_export_at ? (lastExport?.next_export_at | date: 'h:mm a,') : 'None' }}
                                {{ lastExport ? (lastExport.next_export_at | date: 'dd MMM yyyy') : '' }}
                            </span> 
                        </div>
                    </div>
                </div>                  
            </div>
        </div>
    </div>
    <div *ngIf="!isLoading && lastExport && errors" class="tw-mt-40-px tw-shadow-app-card tw-rounded-12-px tw-bg-white tw-border-1-px tw-border-separator">
        <div class="tw-flex tw-justify-between tw-items-center tw-p-24-px">
                <h4 class="tw-font-500">Errors</h4>
        </div>
        <div class="tw-border-separator tw-border-1-px tw-pb-6">
            <div class="tw-mt-10-px tw-p-2 tw-rounded-6-px tw-bg-white">
                <div *ngIf="errors?.EMPLOYEE_MAPPING?.length || groupedErrorStat?.EMPLOYEE_MAPPING || errors?.CATEGORY_MAPPING?.length || groupedErrorStat?.CATEGORY_MAPPING" class="tw-p-24-px">
                    <div class="container">
                        <div class="sub-text-container">
                            <h4 class="tw-text-16-px !tw-font-500 ">Integrations Errors</h4>
                            <h5 class="!tw-text-faded-text-color tw-text-14-px tw-pt-10-px !tw-font-400 !tw-leading-4 tw-pb-4">Check and resolve these errors before trying to re-export them again.</h5>
                        </div>
                    </div>
                </div>

                <div *ngIf="errors?.EMPLOYEE_MAPPING?.length || groupedErrorStat?.EMPLOYEE_MAPPING" class="tw-pl-24-px tw-pr-24-px">
                    <div class="container">
                        <div class="inside-container">
                            <h4 class="tw-text-16-px !tw-font-500 ">Employee Mapping Errors</h4>
                            <div class="flex-wrapper">
                                <h5 class="!tw-text-faded-text-color tw-text-14-px tw-pt-10-px !tw-font-400 !tw-leading-4 tw-pb-2">
                                    <p>Map the employees in Fyle to their corresponding records in Sage Intacct<br>based on unique parameter.</p>
                                </h5>
                                <button type="button" class="tw-text-white tw-text-500 tw-px-30-px tw-py-12-px tw-bg-slightly-normal-text-color tw-rounded-4-px">
                                    Resolve
                                </button>                                
                            </div>
                        </div>
                    </div>
                </div>
                
                <div *ngIf="errors?.CATEGORY_MAPPING?.length || (groupedErrorStat && groupedErrorStat.CATEGORY_MAPPING)" class="tw-pl-24-px tw-pr-24-px tw-mt-3">
                    <div class="container">
                        <div class="inside-container">
                            <h4 class="tw-text-16-px !tw-font-500 ">Category Mapping Errors</h4>
                            <div class="flex-wrapper">
                                <h5 class="!tw-text-faded-text-color tw-text-14-px tw-pt-10-px !tw-font-400 !tw-leading-4 tw-pb-2"><p>Map the employees in Fyle to their corresponding records in Sage Intacct<br>based on unique parameter.</p>
                                </h5>
                                <button type="button" class="tw-text-white tw-text-500 tw-px-30-px tw-py-12-px tw-bg-slightly-normal-text-color tw-rounded-4-px">
                                    Resolve
                            </button> 
                            </div>
                        </div>
                    </div>
                </div>
                <div *ngIf="errors?.INTACCT_ERROR?.length" class="tw-p-24-px">
                    <div class="container">
                        <div class="sub-text-container">
                            <h4 class="tw-text-16-px !tw-font-500 ">Sage Intacct Errors</h4>
                            <h5 class="!tw-text-faded-text-color tw-text-14-px tw-pt-10-px !tw-font-400 !tw-leading-4 tw-pb-4">Check and resolve these errors before trying to re-export them again.</h5>
                        </div>
                    </div>
                </div>
                <div *ngFor="let error of errors?.INTACCT_ERROR" class="tw-pl-24-px tw-pr-24-px tw-pb-6">
                    <div class="container">
                        <div class="inside-container">
                            <h4 class="tw-text-16-px !tw-font-500 ">{{ error.error_title }}</h4>
                            <div class="flex-wrapper">
                                <h5 class="!tw-text-faded-text-color tw-text-14-px tw-pt-10-px !tw-font-400 !tw-leading-4 tw-pb-2"><p>{{ error.error_detail }}</p>
                                </h5>
                                <button type="button" class="tw-flex tw-items-center tw-justify-center tw-rounded tw-bg-white tw-text-black tw-px-4 tw-py-1 tw-border tw-border-gray-300 focus:tw-outline-none focus:tw-ring focus:tw-ring-opacity-50 active:tw-scale-95 transition-transform">
                                    View Expense
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>
</div>