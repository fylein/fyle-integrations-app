@if (isLoading) {
  <div class="tw-flex tw-justify-center tw-items-center tw-h-[75vh]">
    <app-loader></app-loader>
  </div>
}
@if (!isLoading) {
  <div [ngClass]="[brandingStyle.configuration.settingsContainer, isOnboarding ? brandingStyle.common.configurationContents : brandingStyle.common.configurationContentsDashboard, isOnboarding ? 'configuration--contents' : '']">
    <div>
      <app-configuration-step-header [headerText]="'qbd_direct.configuration.importSetting.stepName' | transloco"
        [contentText]="'qbd_direct.configuration.importSetting.contentText' | transloco: {brandName: brandingService.getBrandFullName()}"
        [redirectLink]="supportArticleLink" [showSyncButton]="isOnboarding" [appName]="appName"
        (refreshDimension)="refreshDimensions()">
      </app-configuration-step-header>
    </div>
    <div>
      <form [formGroup]="importSettingForm">
        <div class="tw-p-24-px">
          <div [ngClass]="brandingStyle.configuration.configurationImportCard">
            <app-configuration-toggle-field
              [form]="importSettingForm"
              [label]="'qbd_direct.configuration.importSetting.importCategoriesLabel' | transloco : {brandName: brandingConfig.brandName}"
              [subLabel]="'qbd_direct.configuration.importSetting.importCategoriesSubLabel' | transloco : {brandName: brandingConfig.brandName}"
              [formControllerName]="'importCategories'"
              [isSectionHeader]="false"
              [iconPath]="'arrow-tail-down'"
              [appName]="appName">
            </app-configuration-toggle-field>
            @if (importSettingForm.value.importCategories) {
              <div class="tw-pr-24-px tw-pl-64-px tw-py-0" [ngClass]="{'tw-pb-24-px': !(importSettingForm.value.importCategories && QbdDirectImportCodeFieldCodeConfig[DefaultImportFields.ACCOUNT])}">
                <div class="tw-flex tw-justify-between tw-items-center">
                  <h5 class="lg:tw-w-3/5 md:tw-w-1/2 tw-text-14-px" [ngClass]="[brandingStyle.qbd_direct.onboarding.configurationToggleHeaderText, isConfigToggleLeftAligned ? 'tw-ml-10-px':'']">
                    {{'qbd_direct.configuration.importSetting.chartOfAccountTypes' | transloco}}
                    <p [ngClass]="[brandingStyle.common.inputLabelTextStyle,brandingStyle.qbd_direct.onboarding.configurationToggleDescriptionText]">
                      {{'qbd_direct.configuration.importSetting.chartOfAccountTypesSubLabel' | transloco}}
                    </p>
                  </h5>
                  <div class="p-field-checkbox tw-pl-34-px">
                    <p-multiselect [optionDisabled]="'Expense'" [placeholder]="'qbdDirectImportSettings.selectChartOfAccounts' | transloco" [options]="chartOfAccountTypesList" styleClass="tw-z-2 tw-py-8-px tw-px-12-px" [formControlName]="'chartOfAccountTypes'">
                      <ng-template let-value pTemplate="selectedItems">
                        @for (option of value; track option; let i = $index) {
                          <div class="tw-inline-flex tw-align-items-center">
                            <div>{{ option }}@if (i !== value?.length-1) {
                              <span>,&nbsp;</span>
                            }</div>
                          </div>
                        }
                        @if (!value || value.length === 0) {
                          <div>{{'qbdDirectImportSettings.selectChartOfAccountsSentenceCase' | transloco}}</div>
                        }
                      </ng-template>
                    </p-multiselect>
                  </div>
                </div>
              </div>
            }
            @if (importSettingForm.value.importCategories && QbdDirectImportCodeFieldCodeConfig[DefaultImportFields.ACCOUNT]) {
              <div>
                <app-configuration-select-field
                  [appName]="appName"
                  [form]="importSettingForm"
                  [isDisableTextRequired]="false"
                  [options]="getImportCodeSelectorOptions(DefaultImportFields.ACCOUNT)"
                  [placeholder]="'qbdDirectImportSettings.placeholderImport' | transloco : { field: helper.sentenseCaseConversion(DefaultImportFields.ACCOUNT).toLowerCase(), appName: appName }"
                  [label]="'qbdDirectImportSettings.labelImport' | transloco : { field: helper.sentenseCaseConversion(DefaultImportFields.ACCOUNT).toLowerCase(), appName: appName }"
                  [subLabel]="'qbdDirectImportSettings.subLabelImport' | transloco : { field: helper.sentenseCaseConversion(DefaultImportFields.ACCOUNT).toLowerCase() }"
                  [isMultiLineOption]="true"
                  [isFieldMandatory]="true"
                  [customErrorMessage]="'qbdDirectImportSettings.customErrorMessageImport' | transloco : { field: helper.sentenseCaseConversion(DefaultImportFields.ACCOUNT).toLowerCase() }"
                  [isDisabled]="!QbdDirectImportCodeFieldCodeConfig[DefaultImportFields.ACCOUNT]"
                  [formControllerName]="'importCategoryCode'">
                </app-configuration-select-field>
              </div>
            }
          </div>
          @if (brandingFeatureConfig.featureFlags.importSettings.importItems &&
            exportSettings.reimbursable_expense_export_type !== QbdDirectReimbursableExpensesObject.JOURNAL_ENTRY &&
            exportSettings.credit_card_expense_export_type !== QbdDirectCorporateCreditCardExpensesObject.JOURNAL_ENTRY) {
            <div class="tw-mt-24-px" [ngClass]="brandingStyle.configuration.configurationImportCard"
              >
              <app-configuration-toggle-field
                [form]="importSettingForm"
                [label]="'qbd_direct.configuration.importSetting.importItemsLabel' | transloco : {brandName: brandingConfig.brandName}"
                [subLabel]="'qbd_direct.configuration.importSetting.importItemsSubLabel' | transloco : {brandName: brandingConfig.brandName}"
                [formControllerName]="'importItems'"
                [iconPath]="'arrow-tail-down'"
                [appName]="appName">
              </app-configuration-toggle-field>
            </div>
          }
          @if (isImportMerchantsAllowed && brandingFeatureConfig.featureFlags.importSettings.importVendorsAsMerchants) {
            <div class="tw-mt-24-px" [ngClass]="brandingStyle.configuration.configurationImportCard">
              <app-configuration-toggle-field
                [form]="importSettingForm"
                [label]="'qbd_direct.configuration.importSetting.importVendorsAsMerchantsLabel' | transloco : {brandName: brandingConfig.brandName}"
                [subLabel]="'qbdDirectImportSettings.importVendorsAsMerchantsSubLabel' | transloco : { brandName: brandingConfig.brandName }"
                [formControllerName]="'importVendorsAsMerchants'"
                [iconPath]="'arrow-tail-down'"
                [appName]="appName">
              </app-configuration-toggle-field>
            </div>
          }
          <div>
            <app-configuration-import-field
              [form]="importSettingForm"
              [appName]="appName"
              [accountingFieldOptions]="QbdDirectFields"
              [fyleFieldOptions]="fyleFields"
              [isDestinationFixedImport]="true">
            </app-configuration-import-field>
          </div>
        </div>
        @if (isOnboarding) {
          <app-configuration-step-footer
            [ctaText] = "!isSaveInProgress ? (isOnboarding ? ConfigurationCtaText.SAVE_AND_CONTINUE : ConfigurationCtaText.SAVE) : ConfigurationCtaText.SAVING"
            [isButtonDisabled]="!importSettingForm.valid"
            [showBackButton]="isOnboarding ? true : false"
            (save)="save()"
            [AppName]="appName"
            (navigateToPreviousStep)="navigateToPreviousStep()">
          </app-configuration-step-footer>
        }
      </form>
    </div>
  </div>
}

@if (!isLoading && !isOnboarding) {
  <div class="tw-sticky tw-z-1200 tw-top-0 tw-bottom-0 tw-left-0 tw-right-0 tw-bg-white">
    <app-configuration-step-footer
      [ctaText] = "!isSaveInProgress ? (isOnboarding ? ConfigurationCtaText.SAVE_AND_CONTINUE : ConfigurationCtaText.SAVE) : ConfigurationCtaText.SAVING"
      [isButtonDisabled]="!importSettingForm.valid"
      [showBackButton]="isOnboarding ? true : false"
      (save)="save()"
      [AppName]="appName"
      (navigateToPreviousStep)="navigateToPreviousStep()">
    </app-configuration-step-footer>
  </div>
}

<div>
  <app-configuration-custom-field-creation-dialog
    [customFieldForm]="customFieldForm"
    [showCustomFieldCreationDialog]="showCustomFieldDialog"
    (saveCustomFieldFn)="saveFyleExpenseField()"
    (closeModelFn)="closeModel()">
  </app-configuration-custom-field-creation-dialog>
</div>
@if (isPreviewDialogVisible) {
  <div>
    <app-preview-dialog
      [isPreviewDialogVisible]="true"
      [iconPath]="'assets/illustrations/sageIntacct/IntacctImportSettings.png'" (closeDialog)="closeDialog()"
      [header]="'qbdDirectImportSettings.previewHeader' | transloco">
    </app-preview-dialog>
  </div>
}