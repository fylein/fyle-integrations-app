<p-dialog 
[(visible)]="displayChatDialog"
[closable]="false"
[closeOnEscape]="false"
[showHeader]="false"
[modal]="true"
[draggable]="false"
[resizable]="false"
[style]="{width: '900px'}"
styleClass="ai-onboarding-dialog chat-dialog"
>
<div class="chat-container">
  <div class="chat-header">
    <div class="header-left">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" class="fyle-logo" width="24" height="24">
        <path d="M8.77115 1.89368C8.89036 1.59143 9.31811 1.59143 9.43731 1.89368L11.3258 6.68195C11.3622 6.77423 11.4352 6.84727 11.5275 6.88366L16.3158 8.77213C16.618 8.89133 16.618 9.31908 16.3158 9.43829L11.5275 11.3268C11.4352 11.3631 11.3622 11.4362 11.3258 11.5285L9.43731 16.3167C9.31811 16.619 8.89036 16.619 8.77115 16.3167L6.88269 11.5285C6.84629 11.4362 6.77325 11.3631 6.68097 11.3268L1.8927 9.43829C1.59045 9.31908 1.59045 8.89133 1.8927 8.77213L6.68097 6.88366C6.77325 6.84727 6.84629 6.77422 6.88269 6.68195L8.77115 1.89368Z"/>
        <path d="M15.037 12.6351C15.1562 12.3329 15.5839 12.3329 15.7031 12.6351L16.3257 14.2137C16.3621 14.3059 16.4352 14.379 16.5274 14.4154L18.106 15.038C18.4082 15.1572 18.4082 15.5849 18.106 15.7041L16.5274 16.3267C16.4352 16.3631 16.3621 16.4361 16.3257 16.5284L15.7031 18.107C15.5839 18.4092 15.1562 18.4092 15.037 18.107L14.4144 16.5284C14.378 16.4361 14.305 16.3631 14.2127 16.3267L12.6341 15.7041C12.3319 15.5849 12.3319 15.1572 12.6341 15.038L14.2127 14.4154C14.305 14.379 14.378 14.3059 14.4144 14.2137L15.037 12.6351Z"/>
      </svg>
      <h2 class="copilot-text">Fyle Copilot</h2>
    </div>
    <span class="pi-xl-times fyle" (click)="closeChatDialog()"></span>
  </div>
  
  
  <div class="chat-messages" #chatMessages>
    <div *ngFor="let message of messages" 
         [ngClass]="{'ai-message': message.sender === 'ai', 'user-message': message.sender === 'user'}"
         [@messageAnimation]>
      {{ message.content }}
    </div>
    <div *ngIf="isLoading" class="loading-indicator" [@messageAnimation]>
      <span class="dot"></span>
      <span class="dot"></span>
      <span class="dot"></span>
    </div>
  </div>
  
  <div class="chat-input" [ngClass]="{'first-response': isFirstResponse}">
    <form [formGroup]="chatForm" (ngSubmit)="sendMessage()">
      <div class="input-container">
        <textarea 
          pInputTextarea 
          formControlName="userInput" 
          [autoResize]="true"
          placeholder="Type your answer here..."
          (keydown.enter)="onEnterKey($event)"
        ></textarea>
        <div class="button-container">
          <button pButton type="submit" class="p-button-rounded p-button-text custom-height large-icon tw-pl-24">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M22 2L11 13" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M22 2L15 22L11 13L2 9L22 2Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </button>
          <span 
            class="pi-bin fyle custom-height-bin" 
            (click)="deleteChat()" 
          ></span>
        </div>
      </div>
    </form>
  </div>
</div>
</p-dialog>

<!-- New confirmation popup -->
<p-dialog 
[(visible)]="showCloseConfirmation"
[closable]="false"
[closeOnEscape]="false"
[modal]="true"
[draggable]="false"
[resizable]="false"
[style]="{width: '400px'}"
styleClass="ai-onboarding-dialog confirm-dialog"
>
<ng-template pTemplate="header">
  <div class="dialog-header">
    <h2>Confirm Action</h2>
    <span class="close-icon" (click)="confirmClose(false)">&#10005;</span>
  </div>
</ng-template>
<p>Are you sure you want to close and proceed with manual onboarding?</p>
<ng-template pTemplate="footer">
  <button pButton (click)="confirmClose(true)" label="Yes" class="p-button-raised"></button>
  <button pButton (click)="confirmClose(false)" label="No" class="p-button-raised outline-sm"></button>
</ng-template>
</p-dialog>

<!-- Redirect Progress Dialog -->
<p-dialog 
  [(visible)]="showRedirectProgress"
  [closable]="false"
  [closeOnEscape]="false"
  [showHeader]="false"
  [modal]="true"
  [draggable]="false"
  [resizable]="false"
  [style]="{width: '400px'}"
  styleClass="ai-onboarding-dialog redirect-dialog"
>
  <div class="redirect-content">
    <p>Redirecting to export settings...</p>
    <!-- <p-progressBar mode="indeterminate"></p-progressBar> -->
  </div>
</p-dialog>