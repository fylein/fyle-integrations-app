<p-dialog 
[(visible)]="displayChatDialog"
[closable]="false"
[closeOnEscape]="false"
[showHeader]="false"
[modal]="true"
[draggable]="false"
[resizable]="false"
[style]="{width: '900px'}"
styleClass="ai-onboarding-dialog chat-dialog"
>
<div class="chat-container">
  <div class="chat-header">
    <h2 class="copilot-text">Fyle Copilot</h2>
    <span class="pi-xl-times fyle" (click)="closeChatDialog()"></span>
  </div>
  
  
  <div class="chat-messages" #chatMessages>
    <div *ngFor="let message of messages" 
         [ngClass]="{'ai-message': message.sender === 'ai', 'user-message': message.sender === 'user'}"
         [@messageAnimation]>
      {{ message.content }}
    </div>
    <div *ngIf="isLoading" class="loading-indicator" [@messageAnimation]>
      <span class="dot"></span>
      <span class="dot"></span>
      <span class="dot"></span>
    </div>
  </div>
  
  <div class="chat-input" [ngClass]="{'first-response': isFirstResponse}">
    <form [formGroup]="chatForm" (ngSubmit)="sendMessage()">
      <div class="input-container">
        <textarea 
          pInputTextarea 
          formControlName="userInput" 
          [autoResize]="true"
          placeholder="Type your answer here..."
          (keydown.enter)="onEnterKey($event)"
        ></textarea>
        <div class="button-container">
          <button pButton type="submit" class="p-button-rounded p-button-text custom-height large-icon tw-pl-24">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M22 2L11 13" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M22 2L15 22L11 13L2 9L22 2Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </button>
          <span 
            class="pi-bin fyle custom-height-bin" 
            (click)="closeChatDialog()" 
          ></span>
        </div>
      </div>
    </form>
  </div>
</div>
</p-dialog>

<!-- New confirmation popup -->
<p-dialog 
[(visible)]="showCloseConfirmation"
[closable]="false"
[closeOnEscape]="false"
[modal]="true"
[draggable]="false"
[resizable]="false"
[style]="{width: '400px'}"
styleClass="ai-onboarding-dialog confirm-dialog"
>
<ng-template pTemplate="header">
  <div class="dialog-header">
    <h2>Confirm Action</h2>
    <span class="close-icon" (click)="confirmClose(false)">&#10005;</span>
  </div>
</ng-template>
<p>Are you sure you want to close and proceed with manual onboarding?</p>
<ng-template pTemplate="footer">
  <button pButton (click)="confirmClose(true)" label="Yes" class="p-button-raised"></button>
  <button pButton (click)="confirmClose(false)" label="No" class="p-button-raised outline-sm"></button>
</ng-template>
</p-dialog>

<!-- Redirect Progress Dialog -->
<p-dialog 
  [(visible)]="showRedirectProgress"
  [closable]="false"
  [closeOnEscape]="false"
  [showHeader]="false"
  [modal]="true"
  [draggable]="false"
  [resizable]="false"
  [style]="{width: '400px'}"
  styleClass="ai-onboarding-dialog redirect-dialog"
>
  <div class="redirect-content">
    <p>Redirecting to export settings...</p>
    <!-- <p-progressBar mode="indeterminate"></p-progressBar> -->
  </div>
</p-dialog>